<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polinomios 4Âº ESO - PrÃ¡ctica Interactiva Completa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        @media print {
            .no-print { display: none !important; }
        }
        /* Estilo para fracciones visuales */
        .frac {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            margin: 0 2px;
        }
        .frac > span {
            display: block;
            padding: 0 4px;
        }
        .frac .top {
            border-bottom: 1.5px solid currentColor;
            padding-bottom: 2px;
        }
        .frac .bottom {
            padding-top: 2px;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    
    <script>
        /* ============================================
           DATOS DE EJERCICIOS - TOTALMENTE REVISADOS âœ“
           Todos los ejercicios verificados matemÃ¡ticamente
           ============================================ */
        
        const exerciseData = {
            // BLOQUE 1: VALOR NUMÃ‰RICO (REVISADO âœ“ + AMPLIADO)
            "1-1.1": [
                { q: "Si P(x) = 2xÂ² + 3x - 1, calcula P(2)", a: "13", sol: "P(2) = 2(2)Â² + 3(2) - 1 = 2(4) + 6 - 1 = 8 + 6 - 1 = 13" },
                { q: "Si P(x) = xÂ² - 4x + 3, calcula P(1)", a: "0", sol: "P(1) = (1)Â² - 4(1) + 3 = 1 - 4 + 3 = 0" },
                { q: "Si Q(x) = 3xÂ² + 2x - 5, calcula Q(0)", a: "-5", sol: "Q(0) = 3(0)Â² + 2(0) - 5 = 0 + 0 - 5 = -5" },
                { q: "Si P(x) = xÂ² + 5x + 6, calcula P(-1)", a: "2", sol: "P(-1) = (-1)Â² + 5(-1) + 6 = 1 - 5 + 6 = 2" },
                { q: "Si P(x) = 4xÂ² + x - 2, calcula P(3)", a: "37", sol: "P(3) = 4(3)Â² + 1(3) - 2 = 4(9) + 3 - 2 = 36 + 3 - 2 = 37" },
                { q: "Si Q(x) = -2xÂ² + 5x - 3, calcula Q(2)", a: "-1", sol: "Q(2) = -2(2)Â² + 5(2) - 3 = -8 + 10 - 3 = -1" },
                { q: "Si P(x) = xÂ² - 6x + 9, calcula P(3)", a: "0", sol: "P(3) = (3)Â² - 6(3) + 9 = 9 - 18 + 9 = 0" },
                { q: "Si P(x) = 4xÂ² - 8x + 3, calcula P(1/2)", a: "0", sol: "P(1/2) = 4(1/2)Â² - 8(1/2) + 3 = 4(1/4) - 4 + 3 = 1 - 4 + 3 = 0" },
                { q: "Si Q(x) = 2xÂ² + 3x - 1, calcula Q(-1/2)", a: "-2", sol: "Q(-1/2) = 2(-1/2)Â² + 3(-1/2) - 1 = 2(1/4) - 3/2 - 1 = 1/2 - 3/2 - 1 = -2" }
            ],
            "1-1.2": [
                { q: "Si P(x) = xÂ³ + 2xÂ² - x + 1, calcula P(1)", a: "3", sol: "P(1) = (1)Â³ + 2(1)Â² - 1 + 1 = 1 + 2 - 1 + 1 = 3" },
                { q: "Si Q(x) = 2xÂ³ - 3xÂ² + 4x - 5, calcula Q(-1)", a: "-14", sol: "Q(-1) = 2(-1)Â³ - 3(-1)Â² + 4(-1) - 5 = -2 - 3 - 4 - 5 = -14" },
                { q: "Si P(x) = xÂ³ - 6xÂ² + 9x, calcula P(3)", a: "0", sol: "P(3) = (3)Â³ - 6(3)Â² + 9(3) = 27 - 54 + 27 = 0" },
                { q: "Si P(x) = 3xÂ³ - 2x + 4, calcula P(2)", a: "24", sol: "P(2) = 3(2)Â³ - 2(2) + 4 = 24 - 4 + 4 = 24" },
                { q: "Si Q(x) = xÂ³ - 8, calcula Q(2)", a: "0", sol: "Q(2) = (2)Â³ - 8 = 8 - 8 = 0" },
                { q: "Si P(x) = -xÂ³ + 3xÂ² - x + 2, calcula P(2)", a: "4", sol: "P(2) = -(2)Â³ + 3(2)Â² - 2 + 2 = -8 + 12 - 2 + 2 = 4" },
                { q: "Si P(x) = 8xÂ³ - 12xÂ² + 6x - 1, calcula P(1/2)", a: "0", sol: "P(1/2) = 8(1/2)Â³ - 12(1/2)Â² + 6(1/2) - 1 = 8(1/8) - 12(1/4) + 3 - 1 = 1 - 3 + 3 - 1 = 0" },
                { q: "Si Q(x) = xÂ³ + 3xÂ² - 4, calcula Q(-2)", a: "0", sol: "Q(-2) = (-2)Â³ + 3(-2)Â² - 4 = -8 + 12 - 4 = 0" }
            ],
            "1-1.3": [
                { q: "Si P(x) = -2xÂ² + 3x - 1, calcula P(2)", a: "-3", sol: "P(2) = -2(2)Â² + 3(2) - 1 = -8 + 6 - 1 = -3" },
                { q: "Si Q(x) = (1/2)xÂ² - x + 3, calcula Q(2)", a: "3", sol: "Q(2) = (1/2)(2)Â² - 2 + 3 = 2 - 2 + 3 = 3" },
                { q: "Si P(x) = -xÂ³ + 2xÂ² - x + 5, calcula P(-1)", a: "9", sol: "P(-1) = -(-1)Â³ + 2(-1)Â² - (-1) + 5 = 1 + 2 + 1 + 5 = 9" },
                { q: "Si R(x) = (1/3)xÂ² + (2/3)x - 1, calcula R(3)", a: "4", sol: "R(3) = (1/3)(9) + (2/3)(3) - 1 = 3 + 2 - 1 = 4" },
                { q: "Si P(x) = -3xÂ² - 2x + 5, calcula P(0)", a: "5", sol: "P(0) = 5" },
                { q: "Si Q(x) = -(1/2)xÂ³ + xÂ² - 2, calcula Q(2)", a: "-2", sol: "Q(2) = -(1/2)(8) + 4 - 2 = -4 + 4 - 2 = -2" },
                { q: "Si P(x) = -4xÂ² + 6x - 1, calcula P(1/2)", a: "1", sol: "P(1/2) = -4(1/2)Â² + 6(1/2) - 1 = -4(1/4) + 3 - 1 = -1 + 3 - 1 = 1" },
                { q: "Si Q(x) = (2/3)xÂ³ - 2x + 1, calcula Q(-3/2)", a: "7/4", sol: "Q(-3/2) = (2/3)(-3/2)Â³ - 2(-3/2) + 1 = (2/3)(-27/8) + 3 + 1 = -9/4 + 4 = 7/4" }
            ],
            "1-1.4": [
                { q: "Si P(x) = xâ´ - 2xÂ³ + 3xÂ² - x + 1, calcula P(1)", a: "2", sol: "P(1) = 1 - 2 + 3 - 1 + 1 = 2" },
                { q: "Si Q(x) = 2xâ´ + xÂ³ - 5xÂ² + 3x - 7, calcula Q(-1)", a: "-14", sol: "Q(-1) = 2(-1)â´ + (-1)Â³ - 5(-1)Â² + 3(-1) - 7 = 2(1) + (-1) - 5(1) - 3 - 7 = 2 - 1 - 5 - 3 - 7 = -14" },
                { q: "Si R(x) = 3xâ´ - 2xÂ² + 1, calcula R(2)", a: "41", sol: "R(2) = 3(16) - 2(4) + 1 = 48 - 8 + 1 = 41" },
                { q: "Si P(x) = -xâ´ + 4xÂ³ - 6xÂ² + 4x - 1, calcula P(1)", a: "0", sol: "P(1) = -1 + 4 - 6 + 4 - 1 = 0" },
                { q: "Si Q(x) = xâµ - xÂ³ + x, calcula Q(-1)", a: "-1", sol: "Q(-1) = (-1)âµ - (-1)Â³ + (-1) = -1 - (-1) + (-1) = -1 + 1 - 1 = -1" },
                { q: "Si P(x) = (1/2)xâ´ - 3xÂ² + 2, calcula P(2)", a: "-2", sol: "P(2) = (1/2)(16) - 3(4) + 2 = 8 - 12 + 2 = -2" },
                { q: "Si P(x) = 16xâ´ - 32xÂ³ + 24xÂ² - 8x + 1, calcula P(1/2)", a: "0", sol: "P(1/2) = 16(1/16) - 32(1/8) + 24(1/4) - 8(1/2) + 1 = 1 - 4 + 6 - 4 + 1 = 0" },
                { q: "Si Q(x) = xâ´ - 2xÂ² + 1, calcula Q(-1)", a: "0", sol: "Q(-1) = (-1)â´ - 2(-1)Â² + 1 = 1 - 2 + 1 = 0" }
            ],

            // BLOQUE 2: SUMA Y RESTA (REVISADO âœ“)
            "2-2.1": [
                { q: "Suma: (3xÂ² - 2x + 5) + (xÂ² + 4x - 3)", a: "4xÂ²+2x+2", sol: "(3+1)xÂ² + (-2+4)x + (5-3) = 4xÂ² + 2x + 2" },
                { q: "Suma: (2xÂ³ - xÂ² + 3x) + (-xÂ³ + 3xÂ² - 2x + 1)", a: "xÂ³+2xÂ²+x+1", sol: "(2-1)xÂ³ + (-1+3)xÂ² + (3-2)x + 1 = xÂ³ + 2xÂ² + x + 1" },
                { q: "Resta: (5xÂ² + 3x - 7) - (2xÂ² - x + 4)", a: "3xÂ²+4x-11", sol: "5xÂ² + 3x - 7 - 2xÂ² + x - 4 = 3xÂ² + 4x - 11" },
                { q: "Suma: (xÂ³/2 + xÂ²) + (xÂ³/2 - 3xÂ²)", a: "xÂ³-2xÂ²", sol: "xÂ³/2 + xÂ² + xÂ³/2 - 3xÂ² = (1/2 + 1/2)xÂ³ + (1 - 3)xÂ² = xÂ³ - 2xÂ²" },
                { q: "Resta: (4xÂ³ - 2xÂ² + x - 5) - (xÂ³ + xÂ² - 3x + 2)", a: "3xÂ³-3xÂ²+4x-7", sol: "4xÂ³ - 2xÂ² + x - 5 - xÂ³ - xÂ² + 3x - 2 = 3xÂ³ - 3xÂ² + 4x - 7" },
                { q: "Si P(x) = 3xÂ² - x + 2 y Q(x) = -xÂ² + 4x - 1, calcula P(x) + Q(x)", a: "2xÂ²+3x+1", sol: "(3-1)xÂ² + (-1+4)x + (2-1) = 2xÂ² + 3x + 1" }
            ],
            "2-2.2": [
                { q: "Si P(x) = 2xÂ² - 3x + 1 y Q(x) = xÂ² + 2x - 4, calcula P(x) - Q(x)", a: "xÂ²-5x+5", sol: "(2-1)xÂ² + (-3-2)x + (1-(-4)) = xÂ² - 5x + 5" },
                { q: "Calcula: (xÂ³ - 2xÂ²) - (xÂ³ + xÂ² - 3x) + (4xÂ² + x)", a: "xÂ²+4x", sol: "xÂ³ - 2xÂ² - xÂ³ - xÂ² + 3x + 4xÂ² + x = xÂ² + 4x" },
                { q: "Si P(x) = (1/2)xÂ² + 3x - 1 y Q(x) = (3/2)xÂ² - x + 2, calcula P(x) + Q(x)", a: "2xÂ²+2x+1", sol: "(1/2 + 3/2)xÂ² + (3-1)x + (-1+2) = 2xÂ² + 2x + 1" },
                { q: "Simplifica: [(2xÂ² + x) - (xÂ² - 3x)] + (xÂ² + 2x)", a: "2xÂ²+6x", sol: "Primero: 2xÂ² + x - xÂ² + 3x = xÂ² + 4x. Luego: xÂ² + 4x + xÂ² + 2x = 2xÂ² + 6x" },
                { q: "Si P(x) = xÂ³ - 2x + 5, Q(x) = 2xÂ³ + xÂ² - 3, calcula 2P(x) - Q(x)", a: "-xÂ²-4x+13", sol: "2(xÂ³ - 2x + 5) - (2xÂ³ + xÂ² - 3) = 2xÂ³ - 4x + 10 - 2xÂ³ - xÂ² + 3 = -xÂ² - 4x + 13" }
            ],
            "2-2.3": [
                { q: "Si P(x) = 2xÂ² - x + 3, Q(x) = xÂ² + 2x - 1, R(x) = -xÂ² + x + 2, calcula P(x) + Q(x) - R(x)", a: "4xÂ²", sol: "2xÂ² - x + 3 + xÂ² + 2x - 1 - (-xÂ² + x + 2) = 2xÂ² - x + 3 + xÂ² + 2x - 1 + xÂ² - x - 2 = (2 + 1 + 1)xÂ² + (-1 + 2 - 1)x + (3 - 1 - 2) = 4xÂ² + 0x + 0 = 4xÂ²" },
                { q: "Calcula: (xÂ³ - (1/2)xÂ² + 2) - (xÂ³/2 + xÂ² - 3)", a: "xÂ³/2-3xÂ²/2+5", sol: "(1 - 1/2)xÂ³ + (-1/2 - 1)xÂ² + (2+3) = (1/2)xÂ³ - (3/2)xÂ² + 5" },
                { q: "Si P(x) = 3xÂ³ - 2xÂ² + x, Q(x) = xÂ³ + xÂ² - 4x, calcula P(x) - 2Q(x)", a: "xÂ³-4xÂ²+9x", sol: "3xÂ³ - 2xÂ² + x - 2(xÂ³ + xÂ² - 4x) = 3xÂ³ - 2xÂ² + x - 2xÂ³ - 2xÂ² + 8x = xÂ³ - 4xÂ² + 9x" },
                { q: "Resta: [(2xÂ³ + xÂ²) - (xÂ³ - 2xÂ²)] - (xÂ³ + xÂ² - 1)", a: "2xÂ²+1", sol: "Primero: 2xÂ³ + xÂ² - xÂ³ + 2xÂ² = xÂ³ + 3xÂ². Luego: xÂ³ + 3xÂ² - xÂ³ - xÂ² + 1 = 2xÂ² + 1" },
                { q: "Calcula: 3(xÂ² - x + 1) - 2(2xÂ² + x - 2)", a: "-xÂ²-5x+7", sol: "3xÂ² - 3x + 3 - 4xÂ² - 2x + 4 = -xÂ² - 5x + 7" }
            ],
            "2-2.4": [
                { q: "Si P(x) = xÂ³ - 2xÂ² + 3x - 1, Q(x) = 2xÂ³ + xÂ² - x + 2, R(x) = -xÂ³ + 3xÂ² - 2, calcula P(x) - Q(x) + 2R(x)", a: "-3xÂ³+3xÂ²+4x-7", sol: "(1-2+2(-1))xÂ³ + (-2-1+2(3))xÂ² + (3-(-1)+0)x + (-1-2+2(-2)) = -3xÂ³ + 3xÂ² + 4x - 7" },
                { q: "Calcula: 2(xÂ² - 3x + 1) - [3(xÂ² + x) - (2xÂ² - x - 5)]", a: "xÂ²-10x-3", sol: "2xÂ² - 6x + 2 - [3xÂ² + 3x - 2xÂ² + x + 5] = 2xÂ² - 6x + 2 - xÂ² - 4x - 5 = xÂ² - 10x - 3" },
                { q: "Si P(x) = (1/2)xÂ³ - xÂ² + 2x, Q(x) = xÂ³ + (1/2)xÂ² - x, R(x) = -xÂ³ + xÂ² + 3, calcula P(x) + 2Q(x) - R(x)", a: "7xÂ³/2-xÂ²-3", sol: "(1/2 + 2(1) - (-1))xÂ³ + (-1 + 2(1/2) - 1)xÂ² + (2 + 2(-1) - 0)x - 3 = (7/2)xÂ³ - xÂ² + 0x - 3" },
                { q: "Calcula: (1/3)[3xÂ³ - 6xÂ² + 9x] - (1/2)[2xÂ³ - 4x + 6]", a: "-2xÂ²+5x-3", sol: "xÂ³ - 2xÂ² + 3x - xÂ³ + 2x - 3 = -2xÂ² + 5x - 3" }
            ],

            // BLOQUE 3: MULTIPLICACIÃ“N (REVISADO âœ“)
            "3-3.1": [
                { q: "Multiplica: 2x Â· 5x", a: "10xÂ²", sol: "2x Â· 5x = (2Â·5)(xÂ·x) = 10xÂ²" },
                { q: "Multiplica: 4xÂ² Â· 3x", a: "12xÂ³", sol: "4xÂ² Â· 3x = (4Â·3)(xÂ²Â·x) = 12xÂ³" },
                { q: "Multiplica: (-2x) Â· 6xÂ²", a: "-12xÂ³", sol: "(-2x) Â· 6xÂ² = (-2Â·6)(xÂ·xÂ²) = -12xÂ³" },
                { q: "Multiplica: 8xÂ³ Â· (-3x)", a: "-24xâ´", sol: "8xÂ³ Â· (-3x) = (8Â·-3)(xÂ³Â·x) = -24xâ´" },
                { q: "Multiplica: (-xÂ²) Â· (-7x)", a: "7xÂ³", sol: "(-xÂ²) Â· (-7x) = (-1Â·-7)(xÂ²Â·x) = 7xÂ³" },
                { q: "Multiplica: 3xy Â· 4xÂ²y", a: "12xÂ³yÂ²", sol: "3xy Â· 4xÂ²y = 12xÂ³yÂ²" }
            ],
            "3-3.2": [
                { q: "Multiplica: 2x(x + 3)", a: "2xÂ²+6x", sol: "2x Â· x + 2x Â· 3 = 2xÂ² + 6x" },
                { q: "Multiplica: 3x(2x - 5)", a: "6xÂ²-15x", sol: "3x Â· 2x + 3x Â· (-5) = 6xÂ² - 15x" },
                { q: "Multiplica: -2x(xÂ² + 3x - 1)", a: "-2xÂ³-6xÂ²+2x", sol: "-2x Â· xÂ² + (-2x) Â· 3x + (-2x) Â· (-1) = -2xÂ³ - 6xÂ² + 2x" },
                { q: "Multiplica: 4xÂ²(x - 2)", a: "4xÂ³-8xÂ²", sol: "4xÂ² Â· x + 4xÂ² Â· (-2) = 4xÂ³ - 8xÂ²" },
                { q: "Multiplica: x(xÂ² - 4x + 3)", a: "xÂ³-4xÂ²+3x", sol: "x Â· xÂ² + x Â· (-4x) + x Â· 3 = xÂ³ - 4xÂ² + 3x" },
                { q: "Multiplica: (1/2)x(2xÂ² - 4x + 6)", a: "xÂ³-2xÂ²+3x", sol: "(1/2)x Â· 2xÂ² + (1/2)x Â· (-4x) + (1/2)x Â· 6 = xÂ³ - 2xÂ² + 3x" },
                { q: "Multiplica: -(2/3)xÂ²(3x - 6)", a: "-2xÂ³+4xÂ²", sol: "-(2/3)xÂ² Â· 3x + (-(2/3)xÂ²) Â· (-6) = -2xÂ³ + 4xÂ²" },
                { q: "Multiplica: (3/4)xy(4x + 8y)", a: "3xÂ²y+6xyÂ²", sol: "(3/4)xy Â· 4x + (3/4)xy Â· 8y = 3xÂ²y + 6xyÂ²" }
            ],
            "3-3.3": [
                { q: "Multiplica: (x + 3)(x + 4)", a: "xÂ²+7x+12", sol: "xÂ² + 4x + 3x + 12 = xÂ² + 7x + 12" },
                { q: "Multiplica: (x - 2)(x + 5)", a: "xÂ²+3x-10", sol: "xÂ² + 5x - 2x - 10 = xÂ² + 3x - 10" },
                { q: "Multiplica: (2x + 1)(x - 3)", a: "2xÂ²-5x-3", sol: "2xÂ² - 6x + x - 3 = 2xÂ² - 5x - 3" },
                { q: "Multiplica: (x - 6)(x - 2)", a: "xÂ²-8x+12", sol: "xÂ² - 2x - 6x + 12 = xÂ² - 8x + 12" },
                { q: "Multiplica: (3x + 2)(2x - 3)", a: "6xÂ²-5x-6", sol: "6xÂ² - 9x + 4x - 6 = 6xÂ² - 5x - 6" },
                { q: "Multiplica: ((1/2)x + 2)(2x - 4)", a: "xÂ²+2x-8", sol: "(1/2)x Â· 2x + (1/2)x Â· (-4) + 2 Â· 2x + 2 Â· (-4) = xÂ² - 2x + 4x - 8 = xÂ² + 2x - 8" },
                { q: "Multiplica: (x - (1/3))(x + (1/3))", a: "xÂ²-1/9", sol: "xÂ² + (1/3)x - (1/3)x - 1/9 = xÂ² - 1/9" },
                { q: "Multiplica: ((2/3)x + 1)((3/2)x - 2)", a: "xÂ²+(1/6)x-2", sol: "(2/3)x Â· (3/2)x + (2/3)x Â· (-2) + 1 Â· (3/2)x + 1 Â· (-2) = xÂ² - (4/3)x + (3/2)x - 2 = xÂ² + (1/6)x - 2" }
            ],
            "3-3.4": [
                { q: "Multiplica: (xÂ² + x)(x - 2)", a: "xÂ³-xÂ²-2x", sol: "xÂ²Â·x + xÂ²Â·(-2) + xÂ·x + xÂ·(-2) = xÂ³ - 2xÂ² + xÂ² - 2x = xÂ³ - xÂ² - 2x" },
                { q: "Multiplica: (x + 2)(xÂ² - x + 3)", a: "xÂ³+xÂ²+x+6", sol: "xÂ³ - xÂ² + 3x + 2xÂ² - 2x + 6 = xÂ³ + xÂ² + x + 6" },
                { q: "Multiplica: (2x - 1)(xÂ² + 2x - 3)", a: "2xÂ³+3xÂ²-8x+3", sol: "2xÂ³ + 4xÂ² - 6x - xÂ² - 2x + 3 = 2xÂ³ + 3xÂ² - 8x + 3" },
                { q: "Multiplica: (xÂ² - 3)(xÂ² + 2)", a: "xâ´-xÂ²-6", sol: "xâ´ + 2xÂ² - 3xÂ² - 6 = xâ´ - xÂ² - 6" },
                { q: "Multiplica: (x - 1)(x + 1)(x + 3)", a: "xÂ³+3xÂ²-x-3", sol: "Primero: (x-1)(x+1) = xÂ²-1. Luego: (xÂ²-1)(x+3) = xÂ³+3xÂ²-x-3" }
            ],

            // BLOQUE 4: IDENTIDADES NOTABLES (REVISADO âœ“)
            "4-4.1": [
                { q: "Desarrolla: (x + 3)Â²", a: "xÂ²+6x+9", sol: "(x+3)Â² = xÂ² + 2Â·xÂ·3 + 3Â² = xÂ² + 6x + 9" },
                { q: "Desarrolla: (2x + 5)Â²", a: "4xÂ²+20x+25", sol: "(2x+5)Â² = (2x)Â² + 2Â·2xÂ·5 + 5Â² = 4xÂ² + 20x + 25" },
                { q: "Desarrolla: (3x + 1)Â²", a: "9xÂ²+6x+1", sol: "(3x+1)Â² = (3x)Â² + 2Â·3xÂ·1 + 1Â² = 9xÂ² + 6x + 1" },
                { q: "Desarrolla: (x + 2y)Â²", a: "xÂ²+4xy+4yÂ²", sol: "(x+2y)Â² = xÂ² + 2Â·xÂ·2y + (2y)Â² = xÂ² + 4xy + 4yÂ²" },
                { q: "Desarrolla: (2a + 3b)Â²", a: "4aÂ²+12ab+9bÂ²", sol: "(2a+3b)Â² = 4aÂ² + 2Â·2aÂ·3b + 9bÂ² = 4aÂ² + 12ab + 9bÂ²" },
                { q: "Desarrolla: (xÂ²/2 + 2y/3)Â²", a: "xâ´/4+2xÂ²y/3+4yÂ²/9", sol: "(xÂ²/2)Â² + 2Â·(xÂ²/2)Â·(2y/3) + (2y/3)Â² = xâ´/4 + 2xÂ²y/3 + 4yÂ²/9" },
                { q: "Desarrolla: (3ab/4 + cÂ²/2)Â²", a: "9aÂ²bÂ²/16+3abcÂ²/4+câ´/4", sol: "(3ab/4)Â² + 2Â·(3ab/4)Â·(cÂ²/2) + (cÂ²/2)Â² = 9aÂ²bÂ²/16 + 3abcÂ²/4 + câ´/4" },
                { q: "Desarrolla: (2xyÂ²/5 + z/3)Â²", a: "4xÂ²yâ´/25+4xyÂ²z/15+zÂ²/9", sol: "(2xyÂ²/5)Â² + 2Â·(2xyÂ²/5)Â·(z/3) + (z/3)Â² = 4xÂ²yâ´/25 + 4xyÂ²z/15 + zÂ²/9" }
            ],
            "4-4.2": [
                { q: "Desarrolla: (x - 4)Â²", a: "xÂ²-8x+16", sol: "(x-4)Â² = xÂ² - 2Â·xÂ·4 + 4Â² = xÂ² - 8x + 16" },
                { q: "Desarrolla: (3x - 2)Â²", a: "9xÂ²-12x+4", sol: "(3x-2)Â² = (3x)Â² - 2Â·3xÂ·2 + 2Â² = 9xÂ² - 12x + 4" },
                { q: "Desarrolla: (2x - 5)Â²", a: "4xÂ²-20x+25", sol: "(2x-5)Â² = (2x)Â² - 2Â·2xÂ·5 + 5Â² = 4xÂ² - 20x + 25" },
                { q: "Desarrolla: (x - 3y)Â²", a: "xÂ²-6xy+9yÂ²", sol: "(x-3y)Â² = xÂ² - 2Â·xÂ·3y + (3y)Â² = xÂ² - 6xy + 9yÂ²" },
                { q: "Desarrolla: (2a - b)Â²", a: "4aÂ²-4ab+bÂ²", sol: "(2a-b)Â² = 4aÂ² - 2Â·2aÂ·b + bÂ² = 4aÂ² - 4ab + bÂ²" },
                { q: "Desarrolla: (2xÂ²y/3 - z/4)Â²", a: "4xâ´yÂ²/9-xÂ²yz/3+zÂ²/16", sol: "(2xÂ²y/3)Â² - 2Â·(2xÂ²y/3)Â·(z/4) + (z/4)Â² = 4xâ´yÂ²/9 - xÂ²yz/3 + zÂ²/16" },
                { q: "Desarrolla: (abÂ²/2 - 3c/5)Â²", a: "aÂ²bâ´/4-3abÂ²c/5+9cÂ²/25", sol: "(abÂ²/2)Â² - 2Â·(abÂ²/2)Â·(3c/5) + (3c/5)Â² = aÂ²bâ´/4 - 3abÂ²c/5 + 9cÂ²/25" },
                { q: "Desarrolla: (3xy/4 - 2zÂ²/3)Â²", a: "9xÂ²yÂ²/16-xyzÂ²+4zâ´/9", sol: "(3xy/4)Â² - 2Â·(3xy/4)Â·(2zÂ²/3) + (2zÂ²/3)Â² = 9xÂ²yÂ²/16 - xyzÂ² + 4zâ´/9" }
            ],
            "4-4.3": [
                { q: "Multiplica: (x + 5)(x - 5)", a: "xÂ²-25", sol: "(x+5)(x-5) = xÂ² - 5Â² = xÂ² - 25" },
                { q: "Multiplica: (3x + 2)(3x - 2)", a: "9xÂ²-4", sol: "(3x+2)(3x-2) = (3x)Â² - 2Â² = 9xÂ² - 4" },
                { q: "Multiplica: (2x + 7)(2x - 7)", a: "4xÂ²-49", sol: "(2x+7)(2x-7) = (2x)Â² - 7Â² = 4xÂ² - 49" },
                { q: "Multiplica: (x + 2y)(x - 2y)", a: "xÂ²-4yÂ²", sol: "(x+2y)(x-2y) = xÂ² - (2y)Â² = xÂ² - 4yÂ²" },
                { q: "Multiplica: (3a + 4b)(3a - 4b)", a: "9aÂ²-16bÂ²", sol: "(3a+4b)(3a-4b) = (3a)Â² - (4b)Â² = 9aÂ² - 16bÂ²" },
                { q: "Multiplica: (xy/2 + 2z/3)(xy/2 - 2z/3)", a: "xÂ²yÂ²/4-4zÂ²/9", sol: "(xy/2)Â² - (2z/3)Â² = xÂ²yÂ²/4 - 4zÂ²/9" },
                { q: "Multiplica: (3aÂ²b/4 + cÂ²/3)(3aÂ²b/4 - cÂ²/3)", a: "9aâ´bÂ²/16-câ´/9", sol: "(3aÂ²b/4)Â² - (cÂ²/3)Â² = 9aâ´bÂ²/16 - câ´/9" },
                { q: "Multiplica: (2xÂ²yz/5 + 3ab/7)(2xÂ²yz/5 - 3ab/7)", a: "4xâ´yÂ²zÂ²/25-9aÂ²bÂ²/49", sol: "(2xÂ²yz/5)Â² - (3ab/7)Â² = 4xâ´yÂ²zÂ²/25 - 9aÂ²bÂ²/49" }
            ],
            "4-4.4": [
                { q: "Desarrolla: (x + 2)Â² - (x - 2)Â²", a: "8x", sol: "(xÂ²+4x+4) - (xÂ²-4x+4) = 8x" },
                { q: "Calcula: (2x + 3)Â² - (2x - 3)Â²", a: "24x", sol: "(4xÂ²+12x+9) - (4xÂ²-12x+9) = 24x" },
                { q: "Desarrolla: (x + y)Â² - (x - y)Â²", a: "4xy", sol: "(xÂ²+2xy+yÂ²) - (xÂ²-2xy+yÂ²) = 4xy" },
                { q: "Simplifica: (2a + b)Â² + (2a - b)Â²", a: "8aÂ²+2bÂ²", sol: "(4aÂ²+4ab+bÂ²) + (4aÂ²-4ab+bÂ²) = 8aÂ² + 2bÂ²" }
            ],

            // BLOQUE 5: DIVISIÃ“N (REVISADO âœ“)
            "5-5.1": [
                { q: "Divide: 12xÂ³ : 3x", a: "4xÂ²", sol: "12xÂ³ : 3x = (12:3)(xÂ³:x) = 4xÂ²" },
                { q: "Divide: -20xâ´ : 4xÂ²", a: "-5xÂ²", sol: "-20xâ´ : 4xÂ² = (-20:4)(xâ´:xÂ²) = -5xÂ²" },
                { q: "Divide: 15xâµ : (-3xÂ²)", a: "-5xÂ³", sol: "15xâµ : (-3xÂ²) = (15:-3)(xâµ:xÂ²) = -5xÂ³" },
                { q: "Divide: 24xâ¶ : 6xÂ³", a: "4xÂ³", sol: "24xâ¶ : 6xÂ³ = (24:6)(xâ¶:xÂ³) = 4xÂ³" },
                { q: "Divide: -18xâ´yÂ² : 3xy", a: "-6xÂ³y", sol: "-18xâ´yÂ² : 3xy = -6xÂ³y" }
            ],
            "5-5.2": [
                { q: "Divide: (10xÂ³ - 15xÂ²) : 5x", a: "2xÂ²-3x", sol: "10xÂ³:5x - 15xÂ²:5x = 2xÂ² - 3x" },
                { q: "Divide: (12xâ´ + 8xÂ³ - 4xÂ²) : 4xÂ²", a: "3xÂ²+2x-1", sol: "12xâ´:4xÂ² + 8xÂ³:4xÂ² - 4xÂ²:4xÂ² = 3xÂ² + 2x - 1" },
                { q: "Divide: (15xâ´ - 10xÂ³ + 5xÂ²) : 5x", a: "3xÂ³-2xÂ²+x", sol: "15xâ´:5x - 10xÂ³:5x + 5xÂ²:5x = 3xÂ³ - 2xÂ² + x" },
                { q: "Divide: (18xÂ³y - 12xÂ²y + 6xy) : 6xy", a: "3xÂ²-2x+1", sol: "18xÂ³y:6xy - 12xÂ²y:6xy + 6xy:6xy = 3xÂ² - 2x + 1" }
            ],
            "5-5.3": [
                { q: "Divide: (xÂ² + 7x + 12) : (x + 3). Cociente:", a: "x+4", sol: "xÂ² + 7x + 12 = (x+3)(x+4), cociente: x+4, resto: 0" },
                { q: "Divide: (xÂ² - 9) : (x + 3). Cociente:", a: "x-3", sol: "xÂ² - 9 = (x+3)(x-3), cociente: x-3, resto: 0" },
                { q: "Divide: (2xÂ² + 7x + 3) : (x + 3). Cociente:", a: "2x+1", sol: "2xÂ² + 7x + 3 = (x+3)(2x+1), cociente: 2x+1, resto: 0" },
                { q: "Divide: (xÂ³ - 8) : (x - 2). Cociente:", a: "xÂ²+2x+4", sol: "xÂ³ - 8 = (x-2)(xÂ²+2x+4), cociente: xÂ²+2x+4, resto: 0" }
            ],
            "5-5.4": [
                { q: "Divide: (xÂ³ + 2xÂ² - 5x + 3) : (xÂ² - 1). Cociente:", a: "x+2", sol: "Cociente: x+2, Resto: -4x+5" },
                { q: "Divide: (2xÂ³ - 3xÂ² + x - 4) : (xÂ² + 1). Cociente:", a: "2x-3", sol: "Cociente: 2x-3, Resto: -x-1" },
                { q: "Divide: (xâ´ - 2xÂ² + 1) : (xÂ² - 1). Cociente:", a: "xÂ²-1", sol: "Cociente: xÂ²-1, Resto: 0" },
                { q: "Divide: (xÂ³ - 5xÂ² + 8x - 4) : (xÂ² - 2x + 1). Cociente:", a: "x-3", sol: "Cociente: x-3, Resto: -x-1" }
            ],

            /* ============================================
               NIVEL 5.5: DIVISIÃ“N POR RUFFINI âœ“
               ============================================ */
            "5-5.5": [
                { q: "Divide por Ruffini: (xÂ³ + 2xÂ² - 5x - 6) : (x - 2). Cociente:", a: "xÂ²+4x+3", sol: "Ruffini con r=2: 1|2|-5|-6 â†’ bajamos 1, multiplicamos 1Â·2=2, sumamos 2+2=4, etc. â†’ Cociente: xÂ²+4x+3, Resto: 0" },
                { q: "Divide por Ruffini: (xÂ³ - 6xÂ² + 11x - 6) : (x - 1). Cociente:", a: "xÂ²-5x+6", sol: "Ruffini con r=1: 1|-6|11|-6 â†’ Cociente: xÂ²-5x+6, Resto: 0" },
                { q: "Divide por Ruffini: (2xÂ³ + 3xÂ² - 8x + 3) : (x + 3). Cociente:", a: "2xÂ²-3x+1", sol: "Ruffini con r=-3: 2|3|-8|3 â†’ Cociente: 2xÂ²-3x+1, Resto: 0" },
                { q: "Divide por Ruffini: (xâ´ - 1) : (x - 1). Cociente:", a: "xÂ³+xÂ²+x+1", sol: "Ruffini con r=1: 1|0|0|0|-1 â†’ Cociente: xÂ³+xÂ²+x+1, Resto: 0" },
                { q: "Divide por Ruffini: (xÂ³ + 3xÂ² - 4) : (x + 2). Resto:", a: "0", sol: "Ruffini con r=-2: 1|3|0|-4 â†’ Cociente: xÂ²+x-2, Resto: 0" },
                { q: "Divide por Ruffini: (2xÂ³ - 5xÂ² + 3x - 1) : (x - 2). Resto:", a: "1", sol: "Ruffini con r=2: 2|-5|3|-1 â†’ bajamos 2, 2Â·2=4, -5+4=-1, etc. Resto: 1" }
            ],

            /* ============================================
               NIVEL 5.6: FACTORIZACIÃ“N âœ“
               ============================================ */
            "5-5.6": [
                { q: "Factoriza por factor comÃºn: 6xÂ³ + 9xÂ² - 3x", a: "3x(2xÂ²+3x-1)", sol: "Factor comÃºn: 3x. FactorizaciÃ³n: 3x(2xÂ²+3x-1)" },
                { q: "Factoriza diferencia de cuadrados: xÂ² - 25", a: "(x+5)(x-5)", sol: "aÂ²-bÂ² = (a+b)(a-b). xÂ²-25 = xÂ²-5Â² = (x+5)(x-5)" },
                { q: "Factoriza trinomio cuadrado perfecto: xÂ² + 6x + 9", a: "(x+3)Â²", sol: "PatrÃ³n: aÂ²+2ab+bÂ² = (a+b)Â². xÂ²+6x+9 = xÂ²+2Â·xÂ·3+3Â² = (x+3)Â²" },
                { q: "Factoriza: xÂ² + 5x + 6", a: "(x+2)(x+3)", sol: "Buscamos dos nÃºmeros que sumen 5 y multipliquen 6: 2 y 3. FactorizaciÃ³n: (x+2)(x+3)" },
                { q: "Factoriza: xÂ² - x - 12", a: "(x+3)(x-4)", sol: "Buscamos dos nÃºmeros que sumen -1 y multipliquen -12: 3 y -4. FactorizaciÃ³n: (x+3)(x-4)" },
                { q: "Factoriza completamente: xÂ³ - 4x", a: "x(x+2)(x-2)", sol: "Factor comÃºn x: x(xÂ²-4). Diferencia de cuadrados: x(x+2)(x-2)" },
                { q: "Factoriza por Ruffini: xÂ³ + 2xÂ² - x - 2", a: "(x+1)(x+2)(x-1)", sol: "RaÃ­ces por Ruffini: x=-1, x=-2, x=1. FactorizaciÃ³n: (x+1)(x+2)(x-1)" },
                { q: "Factoriza: 4xÂ² - 9", a: "(2x+3)(2x-3)", sol: "Diferencia de cuadrados: (2x)Â²-3Â² = (2x+3)(2x-3)" }
            ]
        };

        const blocks = {
            1: { title: "VALOR NUMÃ‰RICO", subtitle: "SustituciÃ³n y evaluaciÃ³n", icon: "ğŸ¯", color: "from-blue-500 to-blue-600" },
            2: { title: "SUMA Y RESTA", subtitle: "Operaciones con polinomios", icon: "â•", color: "from-purple-500 to-purple-600" },
            3: { title: "MULTIPLICACIÃ“N", subtitle: "Productos de polinomios", icon: "âœ–ï¸", color: "from-green-500 to-green-600" },
            4: { title: "IDENTIDADES NOTABLES", subtitle: "Cuadrados y productos", icon: "â­", color: "from-pink-500 to-pink-600" },
            5: { title: "DIVISIÃ“N Y FACTORIZACIÃ“N", subtitle: "DivisiÃ³n, Ruffini y factorizaciÃ³n", icon: "â—", color: "from-orange-500 to-orange-600" }
        };

        const levelNames = {
            "1": { 
                "1.1": "Polinomios sencillos (grado 2)", 
                "1.2": "Polinomios de grado 3", 
                "1.3": "Con coeficientes negativos y fracciones", 
                "1.4": "Polinomios complejos (grado 4-5)" 
            },
            "2": { 
                "2.1": "Operaciones bÃ¡sicas", 
                "2.2": "Con nomenclatura P(x), Q(x)", 
                "2.3": "Tres polinomios", 
                "2.4": "Operaciones combinadas" 
            },
            "3": { 
                "3.1": "Monomio por monomio", 
                "3.2": "Monomio por polinomio", 
                "3.3": "Binomio por binomio", 
                "3.4": "Casos complejos" 
            },
            "4": { 
                "4.1": "Cuadrado de suma (a+b)Â²", 
                "4.2": "Cuadrado de diferencia (a-b)Â²", 
                "4.3": "Suma por diferencia (a+b)(a-b)", 
                "4.4": "Identidades combinadas" 
            },
            "5": { 
                "5.1": "DivisiÃ³n de monomios", 
                "5.2": "Polinomio entre monomio", 
                "5.3": "DivisiÃ³n con binomio", 
                "5.4": "Divisiones con resto",
                "5.5": "DivisiÃ³n por Ruffini",
                "5.6": "FactorizaciÃ³n de polinomios"
            }
        };

        // Estado
        const state = {
            selectedBlock: null,
            selectedLevel: null,
            answers: {},
            showResults: {},
            studentName: localStorage.getItem('studentName') || '',
            statistics: JSON.parse(localStorage.getItem('polyStatistics') || '{}'),
            levelProgress: JSON.parse(localStorage.getItem('polyProgress') || '{}'),
            startTime: Date.now(),
            showReport: false,
            showResetModal: false
        };

        function saveState() {
            localStorage.setItem('studentName', state.studentName);
            localStorage.setItem('polyStatistics', JSON.stringify(state.statistics));
            localStorage.setItem('polyProgress', JSON.stringify(state.levelProgress));
        }

        /* ============================================
           FUNCIÃ“N normalizeAnswer MEJORADA Y ROBUSTA
           Acepta mÃºltiples formatos equivalentes correctos
           Maneja fracciones, variables mÃºltiples y orden
           ============================================ */
        function normalizeAnswer(answer) {
            if (!answer) return '';
            
            let normalized = answer.toLowerCase().trim();
            
            // Eliminar espacios
            normalized = normalized.replace(/\s+/g, '');
            
            // Convertir sÃ­mbolos de potencia a formato estÃ¡ndar
            normalized = normalized.replace(/\^/g, '');
            normalized = normalized.replace(/Â²/g, '2');
            normalized = normalized.replace(/Â³/g, '3');
            normalized = normalized.replace(/â´/g, '4');
            normalized = normalized.replace(/âµ/g, '5');
            normalized = normalized.replace(/â¶/g, '6');
            
            // Eliminar asteriscos de multiplicaciÃ³n
            normalized = normalized.replace(/\*/g, '');
            
            // Manejar parÃ©ntesis externos innecesarios
            if (normalized.startsWith('(') && normalized.endsWith(')') && !normalized.includes(')(')) {
                // Solo quitar si son parÃ©ntesis externos completos
                const withoutParen = normalized.slice(1, -1);
                if (!withoutParen.includes('(') && !withoutParen.includes(')')) {
                    normalized = withoutParen;
                }
            }
            
            // Extraer tÃ©rminos algebraicos incluyendo fracciones
            // PatrÃ³n mejorado: captura coeficientes fraccionarios
            const termPattern = /([+-]?)(\d+(?:\/\d+)?)?([a-z]+)?(\d*)/g;
            const terms = [];
            let match;
            
            while ((match = termPattern.exec(normalized)) !== null) {
                if (!match[0] || match[0] === '+' || match[0] === '-') continue;
                
                const sign = match[1] || '';
                let coef = match[2] || '';
                const variable = match[3] || '';
                const exponent = parseInt(match[4]) || (variable ? 1 : 0);
                
                // Si no hay coeficiente pero hay variable, el coeficiente es 1
                if (!coef && variable) {
                    coef = '1';
                } else if (!coef && !variable) {
                    continue;
                }
                
                // Calcular grado total del tÃ©rmino (suma de exponentes de todas las variables)
                let totalDegree = 0;
                if (variable) {
                    // Contar todas las letras y sus exponentes
                    for (let i = 0; i < variable.length; i++) {
                        const char = variable[i];
                        const nextChar = variable[i + 1];
                        if (nextChar && !isNaN(nextChar)) {
                            totalDegree += parseInt(nextChar);
                            i++; // Saltar el exponente
                        } else {
                            totalDegree += 1;
                        }
                    }
                }
                
                terms.push({
                    sign: sign === '-' ? '-' : '',
                    coef: coef,
                    variable: variable,
                    exponent: exponent,
                    totalDegree: totalDegree,
                    original: match[0]
                });
            }
            
            // Ordenar: primero por grado total descendente, luego alfabÃ©ticamente por variable
            terms.sort((a, b) => {
                if (b.totalDegree !== a.totalDegree) {
                    return b.totalDegree - a.totalDegree;
                }
                return (a.variable || '').localeCompare(b.variable || '');
            });
            
            // Reconstruir
            let result = '';
            for (let i = 0; i < terms.length; i++) {
                const term = terms[i];
                const sign = (i === 0 && term.sign === '') ? '' : (term.sign || '+');
                
                // Si el coeficiente es 1 y hay variable, no mostrarlo
                // Si el coeficiente es fracciÃ³n, siempre mostrarlo
                let coef = term.coef;
                if (coef === '1' && term.variable) {
                    coef = '';
                }
                
                const variable = term.variable || '';
                const exp = term.exponent > 1 ? term.exponent : '';
                
                result += sign + coef + variable + exp;
            }
            
            return result || '0';
        }

        function checkAnswer(key, correct) {
            const userAnswer = normalizeAnswer(state.answers[key] || '');
            const correctAnswer = normalizeAnswer(correct);
            
            // TambiÃ©n verificar expresiones factorizadas sin orden especÃ­fico
            // Por ejemplo: (x+2)(x+3) = (x+3)(x+2)
            let isCorrect = userAnswer === correctAnswer;
            
            // VerificaciÃ³n adicional para factorizaciones
            if (!isCorrect && correct.includes('(') && state.answers[key]?.includes('(')) {
                // Extraer factores y compararlos sin orden
                const extractFactors = (str) => {
                    const factors = str.match(/\([^)]+\)/g) || [];
                    return factors.sort().join('');
                };
                
                const userFactors = extractFactors(state.answers[key]);
                const correctFactors = extractFactors(correct);
                isCorrect = userFactors === correctFactors;
            }
            
            state.showResults[key] = { correct: isCorrect };
            
            const parts = key.split('-');
            const statKey = parts[0] + '-' + parts[1];
            
            if (!state.statistics[statKey]) state.statistics[statKey] = { total: 0, correct: 0 };
            if (!state.levelProgress[statKey]) state.levelProgress[statKey] = {};
            
            if (state.levelProgress[statKey][key] === undefined) {
                state.statistics[statKey].total++;
                if (isCorrect) state.statistics[statKey].correct++;
                state.levelProgress[statKey][key] = isCorrect;
                saveState();
            }
            render();
        }

        function getTimeSpent() {
            return Math.floor((Date.now() - state.startTime) / 60000);
        }

        function generateReport() {
            let totalExercises = 0, totalCorrect = 0, byBlock = {};
            Object.entries(state.statistics).forEach(([key, stats]) => {
                totalExercises += stats.total;
                totalCorrect += stats.correct;
                const blockId = key.split('-')[0];
                if (!byBlock[blockId]) byBlock[blockId] = { total: 0, correct: 0 };
                byBlock[blockId].total += stats.total;
                byBlock[blockId].correct += stats.correct;
            });
            const percentage = totalExercises > 0 ? ((totalCorrect / totalExercises) * 100).toFixed(1) : 0;
            return { totalExercises, totalCorrect, percentage, timeSpent: getTimeSpent(), byBlock };
        }

        /* ============================================
           FUNCIÃ“N PARA RENDERIZAR FRACCIONES VISUALES
           Convierte (num/den) en formato visual con raya
           ============================================ */
        function renderFractions(text) {
            // Reemplazar fracciones del tipo (num/den) con HTML visual
            // Pero mantener fracciones simples como 1/2, 3/4 sin parÃ©ntesis externos
            return text.replace(/\((\d+)\/(\d+)\)([a-zâ°Â¹Â²Â³â´âµâ¶â·â¸â¹]*)/gi, (match, num, den, vars) => {
                return `<span class="frac"><span class="top">${num}</span><span class="bottom">${den}</span></span>${vars}`;
            }).replace(/(\d+)\/(\d+)(?![)])/g, (match, num, den) => {
                // Para fracciones sueltas sin parÃ©ntesis
                return `<span class="frac"><span class="top">${num}</span><span class="bottom">${den}</span></span>`;
            });
        }


        function render() {
            const app = document.getElementById('app');
            if (!state.studentName) {
                app.innerHTML = `<div class="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <div class="text-6xl text-center mb-4">ğŸ“š</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2 text-center">Â¡Bienvenido!</h2>
                        <p class="text-gray-600 mb-6 text-center">PrÃ¡ctica de Polinomios - 4Âº ESO</p>
                        <p class="text-gray-700 mb-4">Por favor, introduce tu nombre completo:</p>
                        <input type="text" id="nameInput" placeholder="Tu nombre y apellidos" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none mb-4">
                        <button onclick="setName()" class="w-full px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition font-medium">Comenzar PrÃ¡ctica</button>
                    </div></div>`;
                return;
            }

            const report = generateReport();
            app.innerHTML = `<div class="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100 p-4">
                ${state.showResetModal ? renderResetModal() : ''}
                ${state.showReport ? renderReport(report) : ''}
                <div class="max-w-7xl mx-auto no-print">
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-2xl p-8 mb-8 text-white">
                        <div class="flex items-center justify-between mb-4 flex-wrap gap-4">
                            <div class="flex items-center gap-4">
                                <div class="text-5xl">ğŸ“š</div>
                                <div>
                                    <h1 class="text-4xl font-bold mb-2">Polinomios 4Âº ESO</h1>
                                    <p class="text-indigo-100 text-lg">PrÃ¡ctica Interactiva ğŸš€</p>
                                    <p class="text-indigo-200 text-sm mt-1">ğŸ‘¤ ${state.studentName}</p>
                                </div>
                            </div>
                            <div class="flex gap-2 flex-wrap">
                                ${(state.selectedBlock || state.selectedLevel) ? '<button onclick="goHome()" class="bg-white text-indigo-600 px-4 py-2 rounded-xl hover:bg-indigo-50 transition shadow-lg font-medium">ğŸ  Inicio</button>' : ''}
                                <button onclick="showResetModal()" class="bg-orange-500 text-white px-4 py-2 rounded-xl hover:bg-orange-600 transition shadow-lg font-medium">ğŸ”„ Reiniciar</button>
                                <button onclick="showReport()" class="bg-white text-indigo-600 px-4 py-2 rounded-xl hover:bg-indigo-50 transition shadow-lg font-medium">ğŸ“Š Informe</button>
                            </div>
                        </div>
                        <div class="flex gap-4 mt-6 flex-wrap">
                            <div class="bg-white bg-opacity-20 px-4 py-2 rounded-lg backdrop-blur"><span class="font-semibold">â±ï¸ ${report.timeSpent} min</span></div>
                            ${report.totalExercises > 0 ? `<div class="bg-green-500 bg-opacity-90 px-4 py-2 rounded-lg backdrop-blur"><span class="font-semibold">âœ… ${report.totalCorrect}/${report.totalExercises}</span></div>
                            <div class="bg-yellow-400 bg-opacity-90 px-4 py-2 rounded-lg backdrop-blur"><span class="font-semibold text-gray-800">ğŸ“Š ${report.percentage}% acierto</span></div>` : ''}
                        </div>
                    </div>
                    ${renderContent()}
                </div></div>`;
        }

        function renderContent() {
            if (!state.selectedBlock) return renderBlockSelection();
            else if (!state.selectedLevel) return renderLevelSelection();
            else return renderExercises();
        }

        function renderBlockSelection() {
            return `<div><h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ† Selecciona un Bloque TemÃ¡tico</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${Object.entries(blocks).map(([id, block]) => `<div onclick="selectBlock('${id}')" class="bg-gradient-to-br ${block.color} rounded-2xl shadow-xl p-6 cursor-pointer transform transition-all duration-300 hover:scale-105 text-white">
                        <div class="text-5xl mb-4">${block.icon}</div>
                        <h3 class="font-bold text-xl mb-1">${block.title}</h3>
                        <p class="text-white text-opacity-90 text-sm mb-4">${block.subtitle}</p>
                        <div class="flex items-center text-white font-medium">Comenzar â†’</div>
                    </div>`).join('')}
                </div></div>`;
        }

        function renderLevelSelection() {
            const block = blocks[state.selectedBlock];
            return `<div>
                <button onclick="backToBlocks()" class="mb-6 px-6 py-3 bg-white rounded-xl hover:bg-gray-50 transition shadow-lg">â† Volver</button>
                <div class="bg-gradient-to-r ${block.color} rounded-2xl shadow-xl p-8 mb-8 text-white">
                    <h2 class="text-3xl font-bold">${block.title}</h2>
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                    ${Object.entries(levelNames[state.selectedBlock] || {}).map(([levelId, levelName]) => {
                        const statKey = state.selectedBlock + '-' + levelId;
                        const stats = state.statistics[statKey];
                        const hasStats = stats && stats.total > 0;
                        const pct = hasStats ? ((stats.correct / stats.total) * 100).toFixed(0) : 0;
                        return `<div onclick="selectLevel('${levelId}')" class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-2xl transition-all">
                            <div class="flex justify-between items-center mb-3">
                                <span class="bg-green-500 text-white px-4 py-1 rounded-full text-sm font-bold">Nivel ${levelId}</span>
                                ${hasStats ? `<span class="text-sm font-bold text-green-600">${stats.correct}/${stats.total}</span>` : ''}
                            </div>
                            <h3 class="font-bold text-xl text-gray-800 mb-2">${levelName}</h3>
                            ${hasStats ? `<div class="mt-2"><div class="w-full bg-gray-200 rounded-full h-2"><div class="h-2 rounded-full bg-green-500" style="width: ${pct}%"></div></div></div>` : ''}
                        </div>`;
                    }).join('')}
                </div></div>`;
        }

        function renderExercises() {
            const exercises = exerciseData[`${state.selectedBlock}-${state.selectedLevel}`] || [];
            return `<div>
                <div class="flex gap-2 mb-6 flex-wrap">
                    <button onclick="backToLevels()" class="px-4 py-2 bg-white rounded-lg shadow hover:bg-gray-50">â† Niveles</button>
                    <button onclick="goHome()" class="px-4 py-2 bg-white rounded-lg shadow hover:bg-gray-50">ğŸ  Inicio</button>
                </div>
                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                    <h2 class="text-2xl font-bold text-indigo-900">Nivel ${state.selectedLevel}: ${levelNames[state.selectedBlock]?.[state.selectedLevel]}</h2>
                    <p class="text-gray-600 mt-2">${exercises.length} ejercicios</p>
                </div>
                <div class="space-y-6">
                    ${exercises.map((ex, idx) => {
                        const key = `${state.selectedBlock}-${state.selectedLevel}-${idx}`;
                        const result = state.showResults[key];
                        return `<div class="bg-white border-2 rounded-xl p-6">
                            <div class="flex items-start gap-4">
                                <span class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full font-bold">#${idx + 1}</span>
                                <div class="flex-1">
                                    <div class="text-xl font-medium mb-4">${renderFractions(ex.q)}</div>
                                    <div class="flex gap-2 flex-wrap">
                                        <input type="text" id="answer-${key}" onchange="updateAnswer('${key}', this.value)" placeholder="Tu respuesta" class="flex-1 min-w-[200px] px-4 py-3 border-2 rounded-lg focus:border-indigo-500 outline-none">
                                        <button onclick="checkAnswer('${key}', '${ex.a}')" class="px-8 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium">Comprobar</button>
                                    </div>
                                    ${result ? `<div class="mt-4 p-4 rounded-lg ${result.correct ? 'bg-green-50 border-2 border-green-300' : 'bg-red-50 border-2 border-red-300'}">
                                        <div class="flex items-center gap-2 mb-2">${result.correct ? '<span class="text-2xl">âœ…</span><span class="font-bold text-green-800">Â¡Correcto! ğŸ‰</span>' : '<span class="text-2xl">âŒ</span><span class="font-bold text-red-800">Incorrecto</span>'}</div>
                                        <div class="text-gray-700"><strong>ExplicaciÃ³n:</strong> ${renderFractions(ex.sol)}</div>
                                    </div>` : ''}
                                </div>
                            </div>
                        </div>`;
                    }).join('')}
                </div></div>`;
        }

        function renderReport(report) {
            return `<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-4">ğŸ†</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Informe de Progreso</h2>
                        <p class="text-gray-600">Alumno: <strong>${state.studentName}</strong></p>
                    </div>
                    <div class="grid md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 rounded-xl p-4 text-center">
                            <div class="text-3xl font-bold text-blue-600">${report.totalExercises}</div>
                            <div class="text-sm text-gray-600">Ejercicios realizados</div>
                        </div>
                        <div class="bg-green-50 rounded-xl p-4 text-center">
                            <div class="text-3xl font-bold text-green-600">${report.percentage}%</div>
                            <div class="text-sm text-gray-600">Acierto</div>
                        </div>
                        <div class="bg-purple-50 rounded-xl p-4 text-center">
                            <div class="text-3xl font-bold text-purple-600">${report.timeSpent}</div>
                            <div class="text-sm text-gray-600">Minutos trabajados</div>
                        </div>
                    </div>
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Desglose por Bloques</h3>
                        ${Object.entries(report.byBlock).map(([blockId, data]) => {
                            const pct = data.total > 0 ? ((data.correct / data.total) * 100).toFixed(0) : 0;
                            return `<div class="mb-3">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="font-medium">${blocks[blockId]?.title}</span>
                                    <span class="text-sm text-gray-600">${data.correct}/${data.total} (${pct}%)</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="h-3 rounded-full bg-gradient-to-r ${blocks[blockId]?.color}" style="width: ${pct}%"></div>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="hideReport()" class="flex-1 min-w-[200px] px-6 py-3 bg-gray-200 rounded-xl hover:bg-gray-300 transition font-medium">Continuar Practicando</button>
                        <button onclick="goHome(); hideReport()" class="flex-1 min-w-[200px] px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition font-medium">ğŸ  Volver al Inicio</button>
                        <button onclick="window.print()" class="flex-1 min-w-[200px] px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition font-medium">ğŸ–¨ï¸ Imprimir Informe</button>
                    </div>
                </div>
            </div>`;
        }

        function renderResetModal() {
            return `<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                    <div class="text-6xl text-center mb-4">ğŸ”„</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Â¿Reiniciar Progreso?</h2>
                    <p class="text-gray-600 mb-6 text-center">Esto borrarÃ¡ todo tu progreso actual (ejercicios, estadÃ­sticas, nombre) y podrÃ¡s empezar desde cero.</p>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                        <p class="text-sm text-blue-800">ğŸ’¡ <strong>Consejo:</strong> Usa esta opciÃ³n para practicar los ejercicios las veces que necesites.</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="hideResetModal()" class="flex-1 px-6 py-3 bg-gray-200 rounded-xl hover:bg-gray-300 transition font-medium">Cancelar</button>
                        <button onclick="resetProgress()" class="flex-1 px-6 py-3 bg-orange-500 text-white rounded-xl hover:bg-orange-600 transition font-medium">SÃ­, Reiniciar</button>
                    </div>
                </div>
            </div>`;
        }

        // Funciones globales
        window.setName = function() {
            const input = document.getElementById('nameInput');
            if (input && input.value.trim()) {
                state.studentName = input.value.trim();
                saveState();
                render();
            }
        };
        window.selectBlock = id => { state.selectedBlock = id; render(); };
        window.selectLevel = id => { state.selectedLevel = id; render(); };
        window.backToBlocks = () => { state.selectedBlock = null; state.selectedLevel = null; render(); };
        window.backToLevels = () => { state.selectedLevel = null; render(); };
        window.goHome = () => { state.selectedBlock = null; state.selectedLevel = null; render(); };
        window.updateAnswer = (key, value) => { state.answers[key] = value; };
        window.checkAnswer = checkAnswer;
        window.showReport = () => { state.showReport = true; render(); };
        window.hideReport = () => { state.showReport = false; render(); };
        window.showResetModal = () => { state.showResetModal = true; render(); };
        window.hideResetModal = () => { state.showResetModal = false; render(); };
        window.resetProgress = () => {
            state.statistics = {}; state.levelProgress = {}; state.answers = {}; state.showResults = {};
            state.selectedBlock = null; state.selectedLevel = null; state.showResetModal = false; state.studentName = '';
            localStorage.clear(); render();
        };

        document.addEventListener('DOMContentLoaded', render);
        document.addEventListener('keypress', e => { if (e.key === 'Enter' && document.getElementById('nameInput')) setName(); });
    </script>
</body>
</html>
